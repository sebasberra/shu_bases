PERSONAS
--------

Release Notes 
-------------

Version 1.6a 		16/02/2010
------------------------------
	
	* se crea el script "migra_personas_sihos.sql" para la migracion del Sihos
	
	* se agrega el campo "his_cli_sihos" a la tabla "hc_personas" y se agrega el indice
		unico "idx_unique_efector_his_cli_sihos" a dicha tabla para la migracion del
		sistema SiHos
	
		Se ejecutan los siguientes comandos:
	
			ALTER TABLE hc_personas ADD COLUMN his_cli_sihos INTEGER UNSIGNED NULL;

			CREATE UNIQUE INDEX idx_unique_efector_his_cli_sihos 
							ON hc_personas (id_efector,his_cli_sihos); 
							
	* se agrega el registro "SIHOS" en la tabla "origen_info"
	
	* se hizo una prueba de la migracion del sihos con la base de datos de Arequito
	
	* se encontro que el sihos permite mismos numeros de historia clinicas para diferentes personas. En la
		migracion se guarda en la tabla "hc_personas" el primer numero de historia clinica que se encuentre, para
		el caso antes mencionado
		

Version 1.5a		09/02/2010
------------------------------

* se agrega el campo "his_cli_turnos_evaperon" a la tabla "hc_personas" y se agrega el indice
	unico "idx_unique_efector_his_cli_turnos_evaperon" a dicha tabla para la migracion del
	sistema de turnos del hospital "Eva Peron"
	
	Se ejecutan los siguientes comandos:
	
		ALTER TABLE hc_personas ADD COLUMN his_cli_turnos_evaperon INTEGER UNSIGNED NULL;

		CREATE UNIQUE INDEX idx_unique_efector_his_cli_turnos_evaperon 
						ON hc_personas (id_efector,his_cli_turnos_evaperon);
	
* se agrega la migracion de pacientes del sistema de turnos del hospital "eva peron". Para la
	migracion se crea en la carpeta "shu_inicio/scripts/personas/personas/" el archivo 
	"migra_personas_turnos_evaperon.sql"
	
* se hace un dump de lo migrado del sql server de la base de turnos del hospital "eva peron" y se
	guardan estructuras y datos en la carpeta "shu_inicio/scripts/personas/turnos_eva_peron", en 
	el archivo "dump_turnos_evaperon.sql"

* para la obtencion de las fecha julianas se utiliza la fecha "28/12/1800". La funcion MySql para
	transformar las fechas quedo:
	
		DATE_ADD('1800-12-28',INTERVAL %fecha_juliana% DAY)
	
* se agrega el registro "TURNOS EVA PERON" en la tabla "origen_info"

* se le crea indice unico al campo "origen_info" en la tabla "origen_info"

* se cambia la tabla "version" por la estructura de la tabla "versiones" del hmi2

* se adopta las tablas de "efectores" y de "localidades" del hmi2

	ver efectores: release notes 0.3b
	
	ver localidades: release notes 0.1b
	
	pero en vez de usar las tabla como InnoDB, se pasan a MyISAM. 
	Se crearon 2 bases de datos "efectores_myisam" y "localidades_myisam" para copiar las tablas

* se cambiaron los registros de "personas" que tengan en el campo "estado_civil" igual a "" por
	el valor de NULL
	
* se toma como descripciones estandar para estado civil las siguientes, las cuales vienen del SICAP

	"NULL"
	"dato no registrado"
	"soltero"
	"viudo"
	"casado"
	"separado"
	"divorciado"
	

	
Version 1.4b          25/11/2009
--------------------------------
 
* se agregan los campos "cod_prov" y "cod_pais" a la tabla "localidades"
	
* se elimina la tabla "servicios" y la tabla "efectores_servicios" porque ahora se van
	a incluir en la base "hmi2"
	
* luego de la integracion se ejecuta un script para limpieza que realiza lo siguiente:
	
	- elimina las personas que vengan del padron electoral con tipo_doc = "DNR" y el nro_doc 
		ya existe en la tabla personas
	
	- elimina documentos menores de 6 digitos que no sean "cedula de identidad" que sean del padron o del 
		sistema de turnos del cullen
		
	- elimina las personas que tengan mismo nro_doc, mismo apellido, nombre, pero distinto tipo_doc y 
		que sean del turnos del cullen o del padron electoral. El filtro se aplica entre registros que
		provengan del HMI o del SICAP contra los registros del turnos de cullen y del padron electoral
	
	- elimina las personas que tengan mismo nro_doc, mismo apellido y nombre y distinto tipo_doc y sean
		del hmi de un lado y del sicap del otro, asegurando que no se pierda la historia clinica correspondiente.
		El criterio del registro que queda de la tabla "personas" es que sea del HMI y tipo_doc = 'DNI' y que tenga
		un tipo_doc<>'DNI' en el SICAP
		
	- limpia los registros que empiecen con nombre = "* ". Estos registros se dieron porque en el iturraspe
		se ha usado el asterisco para separar el apellido del nombre en el HMI
		
 

Version 1.4a
--------------------------------

* se agrega el cod_dpto, que es el codigo de departamento de mod_sims, a las localidades.

* se agrega la tabla "dependencias_administrativas" que corresponde a la tabla "d_depenadm"
	del "mod_sims"
	
* se agrega el campo "id_dependencia_adm" a la tabla "efectores" que identifica la dependencia administrativa del
	del establecimiento(efector)
 
* se agrega como prueba la tabla "efectores_servicios" y se inician las pruebas de migración.
	se encontraron valores duplicados para la combinacion efector-servicio

* se agrega el indice unico "idx_unique_servicios" al campo "cod_servicio" de la tabla "servicios". Este
	campo corresponde al codigo de 3 digitos que se usa para estadistica.


Version 1.2b
--------------------------------

* Se cambia el campo "fallecido_fecha" por "fecha_ultima_cond" de la tabla
	"personas", que contiene el campo concatenado y transformado a tipo fecha 
	de los campos FCANIO, FCMES y FCDIA del HMI.
	Estos campos corresponden a la fecha de última condición, de manera que
	en los casos que la persona tenga la marca de fallecida, este campo
	tiene la fecha de defuncion y en caso contrario será la fecha de última
	atención.

* Se cambia tipo de dato del campo "tipo_doc" de la tabla "personas" a CHAR(3)

* Se agregan los siguientes indices:

	tabla "personas":
		"idx_fallecido" para el campo "fallecido" 
		"idx_fecha_ultima_cond" para el campo "fecha_ultima_cond"
		
	tabla "hc_personas"
		indice único "idx_unique_efector_his_cli_internacion_hmi" para los campos 
			"id_efector" y "his_cli_internacion_hmi"
		indice único "idx_unique_efector_his_cli_ce_hmi" para los campos 
			"id_efector" y "his_cli_ce_hmi"
		
* Debido a que se han encontrado números de historia clínica repetidos en el HMI para un mismo
	hospital, esta versión ignorará los duplicados, de manera, que se guardará el primer
	número de historia clinica encontrado para el caso mencionado.
	
* Se cambian en la tabla "hc_personas" los campos "his_cli_internacion_hmi" y 
	"his_cli_ce_hmi" por la siguiente definición:
	
	his_cli_internacion_hmi		INTEGER UNSIGNED NULL,
  	his_cli_ce_hmi 				INTEGER UNSIGNED NULL
  	
* Se cambia en el proceso de importación del HMI el tratamiento de los números 
	de historias clinicas correspondiente a los campos S1HISCLI y S3HISCLICE,
	donde a partir de esta versión, para valores '00000000' de dichos campos,
	de pasará NULL a los campos de "hc_personas": "his_cli_internacion_hmi" y
	"his_cli_ce_hmi", respectivamente. 

* Se agrega la tabla "origen_info" que contiene la tabla de codigo de los diferentes
	origenes de los datos integrados
	
* Se agrega el campo "id_origen" a la tabla "personas"

* Se agrega la tabla "version" que tiene informacion de la creación de la base vigente. 
	Posee los campos "version" y "fecha" que especifican lo dicho.
	
* Se corrigieron los nombres de indices de las tablas "personas" y "hc_personas" usando
	la nombreclatura: 
		idx_nombre_de_campo: para indices comunes
		idx_unique_nombre_de_campo: para indices unicos
		fk_nombre_de_campo: para indices de clave ajena
