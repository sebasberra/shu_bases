/* carga la info del sihos tomada de un dump */

/* NOTA: para poder ver las tablas de sihos hay que utilizar un servidor mysql de la   */
/* version 4.0 porque con la 5.1 da error de tabla corrupta. Hacer un dump de la tabla */
/* ihegresos con las siguientes opciones FIELDS	TERMINATED BY '\t' LINES	TERMINATED BY '\n'; */

DROP TABLE IF EXISTS ihegresos_sihos;

CREATE TABLE ihegresos_sihos (
  IHEGR_ZONA					char(1)			NULL		DEFAULT NULL,
  IHEGR_CODDPTO					char(3)			NULL		DEFAULT NULL,
  IHEGR_CODLOC					char(2)			NULL		DEFAULT NULL,
  IHEGR_CODEST					varchar(5)		NULL		DEFAULT NULL,
  IHEGR_DEPADM					char(1)			NULL		DEFAULT NULL,
  IHEGR_ANOINFORME				varchar(4)		NULL		DEFAULT NULL,
  IHEGR_NROINFORME				varchar(5)		NULL		DEFAULT NULL,
  IHEGR_NROHISCLI				varchar(9)		NULL		DEFAULT NULL,
  IHEGR_FECHANAC				varchar(10) 	NULL 		DEFAULT NULL,
  IHEGR_TIPODOCUM				char(1) 		NULL 		DEFAULT NULL,
  IHEGR_NRODOCUM				varchar(9) 		NULL 		DEFAULT NULL,
  IHEGR_EDAD					char(3) 		NULL 		DEFAULT NULL,
  IHEGR_TIPOEDAD				char(1) 		NULL 		DEFAULT NULL,
  IHEGR_SEXO					char(1) 		NULL 		DEFAULT NULL,
  IHEGR_TIPODOCUMMADRE			char(1) 		NULL 		DEFAULT NULL,
  IHEGR_NRODOCUMMADRE			varchar(9) 		NULL 		DEFAULT NULL,
  IHEGR_APELLIDO				varchar(30) 	NULL 		DEFAULT NULL,
  IHEGR_NOMBRE					varchar(30) 	NULL 		DEFAULT NULL,
  IHEGR_DIRECCION				varchar(30) 	NULL 		DEFAULT NULL,
  IHEGR_DIRNRO					varchar(5) 		NULL 		DEFAULT NULL,
  IHEGR_PISO					varchar(5) 		NULL 		DEFAULT NULL,
  IHEGR_DEP						varchar(5) 		NULL 		DEFAULT NULL,
  IHEGR_TELEFONO				varchar(15) 	NULL 		DEFAULT NULL,
  IHEGR_BARRIO					varchar(25) 	NULL 		DEFAULT NULL,
  IHEGR_LOCRESHAB				char(2) 		NULL 		DEFAULT NULL,
  IHEGR_DPTORESHAB				char(3) 		NULL 		DEFAULT NULL,
  IHEGR_PROVRESHAB				char(2) 		NULL 		DEFAULT NULL,
  IHEGR_PAISRESHAB				char(3) 		NULL 		DEFAULT NULL,
  IHEGR_OBRSOCIAL				char(1) 		NULL 		DEFAULT NULL,
  IHEGR_CODOBRSOCIAL			varchar(5) 		NULL 		DEFAULT NULL,
  IHEGR_CONDICION				char(1) 		NULL 		DEFAULT NULL,
  IHEGR_INSTRUCCION				char(1) 		NULL 		DEFAULT NULL,
  IHEGR_SISTEDUNOREF			char(1) 		NULL 		DEFAULT NULL,
  IHEGR_SISTEDUREF				char(1) 		NULL 		DEFAULT NULL,
  IHEGR_SUPUNIV					char(1) 		NULL 		DEFAULT NULL,
  IHEGR_SITLABORAL				char(1) 		NULL 		DEFAULT NULL,
  IHEGR_OCUPHABITUAL			varchar(5) 		NULL 		DEFAULT NULL,
  IHEGR_HOSPPOR					char(1) 		NULL 		DEFAULT NULL,
  IHEGR_HORAING					varchar(5) 		NULL 		DEFAULT NULL,
  IHEGR_INGDERIVADOR			char(1) 		NULL 		DEFAULT NULL,
  IHEGR_DIAING					char(2) 		NULL 		DEFAULT NULL,
  IHEGR_MESING					char(2) 		NULL 		DEFAULT NULL,
  IHEGR_ANOING					varchar(4) 		NULL 		DEFAULT NULL,
  IHEGR_SERVING					char(3) 		NULL 		DEFAULT NULL,
  IHEGR_SECINGRESO				char(1) 		NULL 		DEFAULT NULL,
  IHEGR_SUBSECING				char(1) 		NULL 		DEFAULT NULL,
  IHEGR_ESTADAING				varchar(5) 		NULL 		DEFAULT NULL,
  IHEGR_EGRPOR					char(1) 		NULL 		DEFAULT NULL,
  IHEGR_HORAEGR					varchar(5) 		NULL 		DEFAULT NULL,
  IHEGR_DIAEGRESO				char(2) 		NULL 		DEFAULT NULL,
  IHEGR_MESEGRESO				char(2) 		NULL 		DEFAULT NULL,
  IHEGR_ANOEGRESO				varchar(4) 		NULL 		DEFAULT NULL,
  IHEGR_ESTADATOTAL				varchar(5) 		NULL 		DEFAULT NULL,
  IHEGR_CASOSOCIAL				char(1) 		NULL 		DEFAULT NULL,
  IHEGR_DIASPOSTALTA			varchar(5) 		NULL 		DEFAULT NULL,
  IHEGR_OTRASCIRCUNSTANCIAS		varchar(30) 	NULL 		DEFAULT NULL,
  IHEGR_SERVEGR					char(3) 		NULL 		DEFAULT NULL,
  IHEGR_SECEGR					char(1) 		NULL 		DEFAULT NULL,
  IHEGR_SUBSECEGR				char(1) 		NULL 		DEFAULT NULL,
  IHEGR_ESPPREDOMINANTE			char(3) 		NULL 		DEFAULT NULL,
  IHEGR_DIAGPRINCIPAL			varchar(5) 		NULL 		DEFAULT NULL,
  IHEGR_DESCDIAGP				varchar(80) 	NULL 		DEFAULT NULL,
  IHEGR_OTRODIAG				varchar(5) 		NULL 		DEFAULT NULL,
  IHEGR_OTRODIAG2				varchar(5) 		NULL 		DEFAULT NULL,
  IHEGR_OTRODIAG3				varchar(5) 		NULL 		DEFAULT NULL,
  IHEGR_OTRODIAG4				varchar(5) 		NULL 		DEFAULT NULL,
  IHEGR_PROQUIOBS				char(1) 		NULL 		DEFAULT NULL,
  IHEGR_OPERADO					char(1) 		NULL 		DEFAULT NULL,
  IHEGR_DDFECOPER				char(2) 		NULL 		DEFAULT NULL,
  IHEGR_MMFECOPER				char(2) 		NULL 		DEFAULT NULL,
  IHEGR_AAFECOPER				varchar(4) 		NULL 		DEFAULT NULL,
  IHEGR_TIEMPOPREO				char(3) 		NULL 		DEFAULT NULL,
  IHEGR_OPERPRINCIPAL			varchar(4) 		NULL 		DEFAULT NULL,
  IHEGR_OTRAOPER				varchar(4) 		NULL 		DEFAULT NULL,
  IHEGR_OTRAOPER2				varchar(4) 		NULL 		DEFAULT NULL,
  IHEGR_AUTOPSIA				char(1) 		NULL 		DEFAULT NULL,
  IHEGR_LESION					char(1) 		NULL 		DEFAULT NULL,
  IHEGR_LUGOCURRENCIA			char(1) 		NULL 		DEFAULT NULL,
  IHEGR_CAUSAEXTERNA			varchar(5) 		NULL 		DEFAULT NULL,
  IHEGR_TIPOPARTO				char(1) 		NULL 		DEFAULT NULL,
  IHEGR_CONDALNACER				char(1) 		NULL 		DEFAULT NULL,
  IHEGR_SEXONACIDO				char(1) 		NULL 		DEFAULT NULL,
  IHEGR_PESO					varchar(4) 		NULL 		DEFAULT NULL,
  IHEGR_TERMINACION				char(1) 		NULL 		DEFAULT NULL,
  IHEGR_EDADGESTACION			char(2) 		NULL 		DEFAULT NULL,
  IHEGR_PARIDAD					char(2) 		NULL 		DEFAULT NULL,
  IHEGR_DIATERMEMB				char(2) 		NULL 		DEFAULT NULL,
  IHEGR_MESTERMEMB				char(2) 		NULL 		DEFAULT NULL,
  IHEGR_ANOTERMEMB				varchar(4) 		NULL 		DEFAULT NULL,
  IHEGR_USUARIO					varchar(10) 	NULL 		DEFAULT NULL,
  IHEGR_FECHAREGISTRACION		date 			NOT NULL 		DEFAULT '0000-00-00',
  IHEGR_FECHAEGRESO				date 			NOT NULL 		DEFAULT '0000-00-00',
  marca_borrado					BOOLEAN			NOT NULL 		DEFAULT FALSE,
  
  PRIMARY KEY (IHEGR_ZONA,IHEGR_CODDPTO,IHEGR_CODLOC,IHEGR_CODEST,IHEGR_DEPADM,IHEGR_ANOINFORME,IHEGR_NROINFORME),
  KEY IHEGR_DIAGPRINCIPAL		(IHEGR_DIAGPRINCIPAL,IHEGR_SEXO),
  KEY IHEGR_FECHAEGRESO			(IHEGR_FECHAEGRESO),
  KEY IHEGR_ANOINFORME			(IHEGR_ANOINFORME),
  KEY IHEGR_CODDPTO				(IHEGR_CODDPTO),
  KEY IHEGR_CODEST				(IHEGR_CODEST),
  KEY IHEGR_PAISRESHAB (IHEGR_DPTORESHAB,IHEGR_PROVRESHAB,IHEGR_PAISRESHAB),
  KEY IHEGR_nroInforme (IHEGR_CODDPTO,IHEGR_CODLOC,IHEGR_CODEST,IHEGR_ANOINFORME,IHEGR_NROINFORME),
  FULLTEXT KEY IHEGR_USUARIO (IHEGR_USUARIO,IHEGR_ZONA,IHEGR_CODDPTO,IHEGR_CODLOC,IHEGR_CODEST,IHEGR_MESEGRESO,
  								IHEGR_ANOEGRESO)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;


/* carga info de ihegresos */
LOAD DATA LOCAL INFILE './tostado/ihegresos_tostado_2012.txt' 
	INTO TABLE ihegresos_sihos
	CHARACTER SET utf8
	FIELDS	TERMINATED BY '\t'
	LINES	TERMINATED BY '\n';

	
/* ------------------------- */
/* pone NULL a campos vacios */

/* IHEGR_TIPODOCUMMADRE */
UPDATE
	ihegresos_sihos
SET
	IHEGR_TIPODOCUMMADRE = NULL
WHERE
	TRIM(IHEGR_TIPODOCUMMADRE)='';

/* IHEGR_NRODOCUMMADRE */	
UPDATE
	ihegresos_sihos
SET
	IHEGR_NRODOCUMMADRE = NULL
WHERE
	TRIM(IHEGR_NRODOCUMMADRE)='';

/* IHEGR_DIRECCION */	
UPDATE
	ihegresos_sihos
SET
	IHEGR_DIRECCION = NULL
WHERE
	TRIM(IHEGR_DIRECCION)='';

/* IHEGR_DIRNRO */	
UPDATE
	ihegresos_sihos
SET
	IHEGR_DIRNRO = NULL
WHERE
	TRIM(IHEGR_DIRNRO)='';
	
/* IHEGR_PISO */	
UPDATE
	ihegresos_sihos
SET
	IHEGR_PISO = NULL
WHERE
	TRIM(IHEGR_PISO)='';
	
/* IHEGR_DEP */	
UPDATE
	ihegresos_sihos
SET
	IHEGR_DEP = NULL
WHERE
	TRIM(IHEGR_DEP)='';
	
/* IHEGR_OCUPHABITUAL */	
UPDATE
	ihegresos_sihos
SET
	IHEGR_OCUPHABITUAL = NULL
WHERE
	TRIM(IHEGR_OCUPHABITUAL)='';	

/* IHEGR_BARRIO */	
UPDATE
	ihegresos_sihos
SET
	IHEGR_BARRIO = NULL
WHERE
	TRIM(IHEGR_BARRIO)='';	

/* IHEGR_TELEFONO */	
UPDATE
	ihegresos_sihos
SET
	IHEGR_TELEFONO = NULL
WHERE
	TRIM(IHEGR_TELEFONO)='';
	
/* IHEGR_TIPODOCUM */	
UPDATE
	ihegresos_sihos
SET
	IHEGR_TIPODOCUM = NULL
WHERE
	TRIM(IHEGR_TIPODOCUM)='DNR';
	
/* IHEGR_NRODOCUM */	
UPDATE
	ihegresos_sihos
SET
	IHEGR_NRODOCUM = NULL
WHERE
	TRIM(IHEGR_NRODOCUM)='';
	
/* IHEGR_NROHISCLI */	
UPDATE
	ihegresos_sihos
SET
	IHEGR_NROHISCLI = NULL
WHERE
	TRIM(IHEGR_NROHISCLI)='';
	
	

	
/* solo migracion esperanza */

/*UPDATE 
	ihegresos_sihos 
SET 
	IHEGR_NRODOCUM = NULL 
WHERE 
	es_entero(IHEGR_NRODOCUM) = FALSE; 

UPDATE ihegresos_sihos

SET	
	IHEGR_APELLIDO = REPLACE(IHEGR_APELLIDO,'´',' ')
WHERE
	IHEGR_APELLIDO LIKE '%´%'; */
	

	

		
/* solo laguna paiva */
/* en laguna paiva ponen la primer letra del apellido en el nro de historia clinica */
/*UPDATE ihegresos_sihos SET IHEGR_NROHISCLI=SUBSTRING(IHEGR_NROHISCLI,2);*/
